# TASK-023: 手動テストで発見したバグ修正

## 概要
手動テスト中に発見された複数のバグを修正する。

## 問題点

### 1. ユーザー登録後の自動切り替えがされない
**現象**: 新規ユーザー登録後、登録したユーザーに自動で切り替わらない
**影響箇所**: [app/register/page.tsx](../app/register/page.tsx)
**問題**: 登録後に `/` にリダイレクトするが、ヘッダーのユーザー選択は変更されない

### 2. 全プロジェクト画面にエージェント面接依頼ボタンがない
**現象**: ダッシュボードには「エージェントに全プロジェクトの面接を依頼」ボタンがあるが、全プロジェクト画面（browse）にはない
**影響箇所**: [app/projects/browse/page.tsx](../app/projects/browse/page.tsx)
**問題**: ユーザビリティの一貫性がない。全プロジェクト画面でも一括面接依頼ができるべき

### 3. タスク実装方針の回答が不自然
**現象**: 「このタスクの実装方針を教えてください」に対する回答が不自然
**影響箇所**: [app/api/tasks/[id]/conversations/route.ts](../app/api/tasks/[id]/conversations/route.ts:128-164)
**問題**: 「実装方針」「やり方」「方法」などのキーワードに対する適切な応答パターンが定義されていない

### 4. 新規プロジェクト作成機能がない
**現象**: プロジェクト一覧画面に新規プロジェクト作成ボタンがない
**影響箇所**: [app/projects/page.tsx](../app/projects/page.tsx)
**問題**: PM ユーザーがプロジェクトを作成できない

### 5. タスク自動生成時に日付が設定されず、ガントチャートが表示されない
**現象**: AI でタスクを自動生成した時に、タスクに日付（startDate, endDate）が設定されず、ガントチャートが正しく表示されない
**影響箇所**: [app/api/projects/[id]/generate-tasks/route.ts](../app/api/projects/[id]/generate-tasks/route.ts:82-167)
**問題**: タスク生成時に日付を設定していない

### 6. タスク自動割り当てがプロジェクトメンバー以外も含めてしまう
**現象**: タスクを自動割り当てする際、プロジェクトメンバー以外の全ユーザーの中から割り当ててしまっている
**影響箇所**: [app/api/projects/[id]/auto-assign/route.ts](../app/api/projects/[id]/auto-assign/route.ts:32-55)
**問題**: プロジェクトメンバーのみに限定すべき

## 修正方針

### 1. ユーザー登録後の自動切り替え
- 登録完了後にユーザー情報を Cookie に保存
- リダイレクト後に Cookie からユーザー情報を読み取って自動選択

### 2. 全プロジェクト画面にボタン追加
- ダッシュボードと同様のボタンを追加
- 既存の `/api/users/[id]/auto-interview` API を利用

### 3. タスク実装方針の回答改善
- 「実装方針」「やり方」「方法」「どうやって」などのキーワードに対する応答を追加
- タスクの技術的な詳細を含めた具体的な回答を生成

### 4. 新規プロジェクト作成機能
- プロジェクト一覧画面に「新規プロジェクト作成」ボタンを追加（PM のみ表示）
- `/projects/new` ページを作成
- `/api/projects` に POST エンドポイントを追加

### 5. タスク生成時の日付設定
- プロジェクトの開始日を基準に、タスクの開始日と終了日を自動計算
- タスク間の依存関係を考慮した日程配分
- デフォルトで各タスク 1-2 週間の期間を設定

### 6. タスク自動割り当てをメンバーに限定
- プロジェクトメンバーのみを取得
- メンバー内での最適な割り当てを行う

## 実装手順

1. ユーザー登録後の自動切り替え実装
2. 全プロジェクト画面にボタン追加
3. タスク実装方針の回答改善
4. 新規プロジェクト作成機能実装
5. タスク生成時の日付設定
6. タスク自動割り当てのメンバー限定

## 動作確認

各修正について以下を確認：
1. ✅ ユーザー登録後、自動的にそのユーザーに切り替わること
2. ✅ 全プロジェクト画面でも一括面接依頼ができること
3. ✅ タスクチャットで「実装方針を教えて」と聞いて適切な回答が返ること
4. ✅ PM ユーザーで新規プロジェクトを作成できること
5. ✅ タスク自動生成後、ガントチャートが正しく表示されること
6. ✅ タスク自動割り当てがプロジェクトメンバーのみに対して行われること

## 完了条件

- 全ての問題が修正され、動作確認が完了していること
- 修正内容がコミットされていること
