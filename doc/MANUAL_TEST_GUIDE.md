# TASK-022 手動テスト実施ガイド

このガイドでは、TASK-022のE2Eシナリオを手動で再現する手順を説明します。

## 事前準備

### 1. 環境起動

```bash
# データベース起動
docker compose up -d

# 開発サーバー起動
npm run dev
```

### 2. アクセス確認

ブラウザで http://localhost:3000 (または http://localhost:3001) にアクセスできることを確認してください。

---

## ユーザーパターン - 手動テスト手順

### シナリオ1: 新規ユーザー登録

**目的**: 新規ユーザーを登録し、専属AIエージェントが自動生成されることを確認

#### 手順

1. **登録ページへ移動**
   - ヘッダーの「新規登録」リンクをクリック
   - または直接 http://localhost:3000/register にアクセス

2. **フォームに入力**
   - **名前**: 任意の名前を入力 (例: `山田 花子`)
   - **メールアドレス**: 一意のメールアドレスを入力 (例: `hanako.yamada@example.com`)
   - **役割**: 「メンバー」を選択（デフォルト）

3. **スキルを選択**
   - プリセットから3-5個選択 (例: `React`, `TypeScript`, `Node.js`)
   - カスタムスキルを追加する場合:
     - 下部の入力欄にスキル名を入力
     - Enterキーまたは「追加」ボタンをクリック

4. **業界を選択**
   - プリセットから2-3個選択 (例: `AI`, `医療系`)
   - カスタム業界を追加する場合:
     - 下部の入力欄に業界名を入力
     - Enterキーまたは「追加」ボタンをクリック

5. **登録を実行**
   - 「登録」ボタンをクリック

#### ✅ 確認ポイント

- [ ] アラートで「登録が完了しました。専属AIエージェントが作成されました。」と表示される
- [ ] エージェント名が表示される (例: `山田 花子のエージェント`)
- [ ] ダッシュボード (http://localhost:3000/) にリダイレクトされる
- [ ] ヘッダーのユーザー選択ドロップダウンに新規ユーザーが表示される

#### 📸 スクリーンショット撮影ポイント

- 登録ページ初期表示
- フォーム入力完了時
- スキル選択後
- 業界選択後
- 登録成功アラート
- ダッシュボード遷移後

---

### シナリオ2: エージェント間自動面接

**目的**: プロジェクトに面接を申し込み、エージェント間の自動会話が行われることを確認

#### 手順

1. **プロジェクト一覧へ移動**
   - ヘッダーの「プロジェクト」をクリック
   - または http://localhost:3000/projects にアクセス

2. **プロジェクトを選択**
   - 一覧から興味のあるプロジェクトをクリック
   - プロジェクト詳細ページに遷移

3. **面接を申し込む**
   - 「面接を申し込む」ボタンをクリック
   - 処理中の表示を確認

4. **面接完了を確認**
   - 完了通知が表示されるのを待つ (数秒かかる場合があります)
   - 通知ベルアイコンに未読バッジが表示される

#### ✅ 確認ポイント

- [ ] 「面接を申し込む」ボタンが表示される
- [ ] ボタンクリック後、処理中の表示が出る
- [ ] 面接完了の通知が表示される
- [ ] 通知ベルに未読件数が表示される

#### 📸 スクリーンショット撮影ポイント

- プロジェクト一覧ページ
- プロジェクト詳細ページ
- 面接申し込みボタン
- 処理中の表示
- 面接完了通知

---

### シナリオ3: オファー確認

**目的**: 面接に合格したプロジェクトのオファーが表示されることを確認

#### 手順

1. **オファーページへ移動**
   - ヘッダーの「オファー」をクリック
   - または http://localhost:3000/offers にアクセス

2. **オファー一覧を確認**
   - 面接結果が「PASSED」のプロジェクトが表示されることを確認
   - マッチングスコアが表示されることを確認

3. **会話ログを確認**
   - オファーカードの「詳細を見る」をクリック
   - 面接時の会話ログが表示されることを確認

#### ✅ 確認ポイント

- [ ] オファー一覧が表示される
- [ ] プロジェクト名、説明が表示される
- [ ] マッチングスコアが表示される（数値）
- [ ] 会話ログが表示される（質問と回答の履歴）
- [ ] 「オファーを承諾」ボタンが表示される

#### 📸 スクリーンショット撮影ポイント

- オファー一覧ページ
- オファー詳細（会話ログ）
- マッチングスコア表示

---

### シナリオ4: プロジェクト参加決定

**目的**: オファーを承諾し、プロジェクトメンバーとして参加できることを確認

#### 手順

1. **オファーページで承諾**
   - オファーの「オファーを承諾」ボタンをクリック
   - 確認ダイアログが表示される

2. **承諾を確定**
   - 確認ダイアログで「承諾」をクリック
   - 成功メッセージが表示される

3. **プロジェクト一覧で確認**
   - ヘッダーの「プロジェクト」をクリック
   - 参加したプロジェクトが一覧に表示されることを確認

4. **プロジェクト詳細で確認**
   - プロジェクトをクリックして詳細ページへ
   - チームメンバー一覧に自分が表示されることを確認

#### ✅ 確認ポイント

- [ ] 確認ダイアログが表示される
- [ ] 承諾成功のメッセージが表示される
- [ ] プロジェクト一覧に参加プロジェクトが追加される
- [ ] プロジェクト詳細のメンバー一覧に自分が表示される

#### 📸 スクリーンショット撮影ポイント

- 承諾確認ダイアログ
- 成功メッセージ
- プロジェクト一覧（参加後）
- チームメンバー一覧

---

### シナリオ5: タスク実行とエージェントサポート

**目的**: 自分に割り当てられたタスクでエージェントとチャットし、進捗を更新できることを確認

#### 手順

1. **プロジェクト詳細でタスクを確認**
   - 参加しているプロジェクトの詳細ページへ移動
   - WBS（タスク一覧）を確認

2. **自分のタスクを選択**
   - 自分にアサインされているタスクをクリック
   - タスク詳細ページに遷移

3. **タスクエージェントとチャット**
   - チャット欄にメッセージを入力（例: `このタスクの実装方針を教えてください`）
   - 「送信」ボタンをクリック
   - エージェントからの返信を確認

4. **進捗を更新**
   - 進捗スライダーを動かす（例: 50%）
   - 「進捗を更新」ボタンをクリック
   - 更新成功のメッセージを確認

#### ✅ 確認ポイント

- [ ] タスク詳細ページが表示される
- [ ] タスク情報（名前、説明、期限など）が表示される
- [ ] チャットエリアが表示される
- [ ] メッセージ送信後、エージェントから返信がある
- [ ] 進捗スライダーが動かせる
- [ ] 進捗更新後、メッセージが表示される
- [ ] 通知ベルに進捗更新の通知が表示される

#### 📸 スクリーンショット撮影ポイント

- タスク一覧（WBS）
- タスク詳細ページ
- チャット送信前
- チャット送信後（エージェントの返信）
- 進捗スライダー
- 進捗更新後

---

### シナリオ6: タスク完了

**目的**: タスクを100%完了し、プロジェクト統計に反映されることを確認

#### 手順

1. **進捗を100%に更新**
   - タスク詳細ページで進捗スライダーを100%に設定
   - 「進捗を更新」ボタンをクリック

2. **タスクステータスを確認**
   - タスクステータスが「完了」または「COMPLETED」になることを確認

3. **通知を確認**
   - ヘッダーの通知ベルをクリック
   - タスク完了の通知が表示されることを確認

4. **プロジェクト統計を確認**
   - プロジェクト詳細ページに戻る
   - プロジェクト全体の進捗率が更新されていることを確認
   - 完了タスク数が増えていることを確認

5. **エージェントバンクを確認**
   - ヘッダーの「プロフィール」をクリック
   - エージェント実績カードが表示されることを確認
   - 完了タスク数、スコアが表示されることを確認

#### ✅ 確認ポイント

- [ ] タスクステータスが「完了」になる
- [ ] タスク完了の通知が2件表示される（ステータス更新、完了）
- [ ] プロジェクト進捗率が更新される
- [ ] 完了タスク数が増える
- [ ] エージェントバンクに実績が記録される
- [ ] プロフィールページに実績カードが表示される

#### 📸 スクリーンショット撮影ポイント

- 進捗100%設定時
- タスクステータス「完了」
- 完了通知
- プロジェクト統計更新
- エージェント実績カード

---

## PMパターン - 手動テスト手順

### シナリオ1: プロジェクト作成

**目的**: PMユーザーで新規プロジェクトを作成し、プロジェクトエージェントが自動生成されることを確認

#### 手順

1. **PMユーザーに切り替え**
   - ヘッダーのユーザー選択ドロップダウンをクリック
   - 「PM」という役割のユーザーを選択（例: `田中PM`）

2. **プロジェクト作成ページへ移動**
   - 「プロジェクト」をクリック
   - 「新規プロジェクト作成」ボタンをクリック
   - または直接 http://localhost:3000/projects/new にアクセス

3. **プロジェクト情報を入力**
   - **プロジェクト名**: 任意の名前（例: `次世代ECプラットフォーム`）
   - **説明**: プロジェクトの概要を入力
   - **要件定義書**: Markdownで要件を記載

   **要件定義書の例**:
   ```markdown
   # 次世代ECプラットフォーム

   ## 概要
   最新技術を活用したECプラットフォームの構築

   ## 機能要件
   - ユーザー認証機能
   - 商品管理機能
   - 決済機能
   - レコメンド機能（AI活用）

   ## 技術スタック
   - フロントエンド: React, TypeScript
   - バックエンド: Node.js, PostgreSQL
   - AI: Python, TensorFlow
   ```

4. **プロジェクトを作成**
   - 「プロジェクト作成」ボタンをクリック
   - 成功メッセージを確認

5. **自動生成を確認**
   - プロジェクト詳細ページにリダイレクトされることを確認
   - プロジェクト専属エージェント情報が表示されることを確認

#### ✅ 確認ポイント

- [ ] プロジェクト作成フォームが表示される
- [ ] Markdownエディタが使える
- [ ] 作成成功のメッセージが表示される
- [ ] プロジェクト詳細ページに遷移する
- [ ] プロジェクトエージェント情報が表示される

#### 📸 スクリーンショット撮影ポイント

- PMユーザー選択
- プロジェクト作成フォーム
- 要件定義書入力
- 作成成功メッセージ
- プロジェクト詳細ページ

---

### シナリオ2: WBS・ガントチャート自動生成

**目的**: 要件定義からタスクが自動生成され、ガントチャートが表示されることを確認

#### 手順

1. **プロジェクト詳細ページで確認**
   - 作成したプロジェクトの詳細ページにいることを確認
   - タスク数が0であることを確認

2. **タスクを自動生成**
   - 「AIでタスクを自動生成」ボタンをクリック
   - 生成中の表示を確認（数秒かかる場合があります）

3. **生成結果を確認**
   - ページが自動的にリロードされる
   - タスク一覧（WBS）が表示されることを確認
   - 各タスクに以下が設定されていることを確認:
     - タスク名
     - 説明
     - 開始日
     - 終了日
     - エージェント

4. **ガントチャートを確認**
   - ページ下部にガントチャートが表示されることを確認
   - タスクがタイムライン上に配置されていることを確認
   - タスク間の依存関係が線で表示されることを確認

#### ✅ 確認ポイント

- [ ] 「AIでタスクを自動生成」ボタンが表示される（タスク0件時のみ）
- [ ] ボタンクリック後、生成中の表示が出る
- [ ] 8-12件のタスクが生成される
- [ ] 各タスクに専属エージェントが作成される
- [ ] ガントチャートが表示される
- [ ] タスクの開始日・終了日が自動設定される
- [ ] タスク生成完了の通知が表示される

#### 📸 スクリーンショット撮影ポイント

- タスク生成前（ボタン表示）
- 生成中の表示
- タスク一覧（WBS）
- ガントチャート全体
- 個別タスク詳細

---

### シナリオ3: 面接結果確認

**目的**: ユーザーからの面接申し込みを確認し、面接結果を閲覧できることを確認

#### 手順

1. **プロジェクト詳細ページで「面接結果」タブを選択**
   - プロジェクト詳細ページのタブメニューから「面接結果」をクリック

2. **面接一覧を確認**
   - 面接を受けたユーザーの一覧が表示されることを確認
   - 各行に以下が表示されることを確認:
     - ユーザー名
     - 面接日時
     - 結果（PASSED / FAILED）
     - マッチングスコア

3. **合格ユーザーを確認**
   - 結果が「PASSED」のユーザーを確認
   - スコアが高い順にソートされていることを確認

4. **会話ログを確認**
   - ユーザー行の「会話ログを見る」をクリック
   - モーダルまたは詳細ページで会話ログが表示される
   - プロジェクトエージェントとユーザーエージェントの会話が確認できる

#### ✅ 確認ポイント

- [ ] 「面接結果」タブが表示される
- [ ] 面接一覧が表示される
- [ ] PASSED/FAILEDの結果が表示される
- [ ] マッチングスコアが数値で表示される
- [ ] 会話ログが確認できる
- [ ] 質問と回答の履歴が表示される

#### 📸 スクリーンショット撮影ポイント

- 面接結果タブ
- 面接一覧
- 合格ユーザー
- マッチングスコア
- 会話ログ

---

### シナリオ4: タスク自動割り当て

**目的**: プロジェクトエージェントが各ユーザーのスキルを分析し、最適なタスクを自動割り当てできることを確認

#### 手順

1. **メンバーを確保**
   - プロジェクトに十分なメンバーが参加していることを確認
   - 必要に応じて、面接合格者にオファーを送信し承諾してもらう

2. **タスク自動割り当てを実行**
   - プロジェクト詳細ページの「タスクを自動割り当て」ボタンをクリック
   - 処理中の表示を確認

3. **割り当て結果を確認**
   - タスク一覧（WBS）で各タスクに担当者が設定されていることを確認
   - ユーザーのスキルとタスク内容が適切にマッチしていることを確認
   - AI実行可能タスクにはエージェントのみが割り当てられていることを確認

4. **通知を確認**
   - 各メンバーに割り当て通知が送信されていることを確認

#### ✅ 確認ポイント

- [ ] 「タスクを自動割り当て」ボタンが表示される
- [ ] 全タスクに担当者が割り当てられる
- [ ] スキルとタスクのマッチングが適切
- [ ] AI実行タスクはエージェントに割り当て
- [ ] 割り当て完了の通知が表示される
- [ ] WBSが更新される

#### 📸 スクリーンショット撮影ポイント

- 割り当て前のWBS
- 自動割り当てボタン
- 処理中の表示
- 割り当て後のWBS
- 担当者情報

---

### シナリオ5: プロジェクトエージェントとの会話

**目的**: PMがプロジェクトエージェントと会話し、プロジェクト調整ができることを確認

#### 手順

1. **プロジェクト詳細ページでチャットエリアを開く**
   - プロジェクト詳細ページ下部のチャットエリアを確認
   - または「会話」タブをクリック

2. **エージェントに質問**
   - チャット欄にメッセージを入力（例: `現在のプロジェクト進捗状況を教えてください`）
   - 「送信」ボタンをクリック

3. **エージェントからの返信を確認**
   - プロジェクトエージェントから進捗サマリーが返信される
   - 完了タスク数、進行中タスク数などの統計情報が含まれる

4. **課題について相談**
   - さらに質問を入力（例: `遅延しているタスクへの対処方法を提案してください`）
   - エージェントから具体的な提案が返信される

5. **会話履歴を確認**
   - 過去の会話履歴が保存されていることを確認
   - 時系列順に表示されることを確認

#### ✅ 確認ポイント

- [ ] チャットエリアが表示される
- [ ] メッセージ送信ができる
- [ ] エージェントから適切な返信がある
- [ ] 進捗サマリーが含まれる
- [ ] 課題への対処提案がある
- [ ] 会話履歴が保存される

#### 📸 スクリーンショット撮影ポイント

- チャットエリア
- 質問送信前
- エージェントの返信
- 進捗サマリー
- 対処提案
- 会話履歴

---

### シナリオ6: タスク状況確認とPMへの通知

**目的**: タスクエージェントからの進捗報告がPMに通知されることを確認

#### 手順

1. **通知ベルを確認**
   - ヘッダーの通知ベルアイコンに未読件数が表示されることを確認

2. **通知一覧を開く**
   - 通知ベルをクリック
   - 通知ドロップダウンが表示される

3. **タスク報告を確認**
   - タスクエージェントからの進捗報告が表示されることを確認
   - 報告内容（タスク名、進捗率、ステータス）を確認

4. **遅延警告を確認**
   - 遅延しているタスクの警告通知が表示されることを確認
   - 通知タイプが「warning」または「error」になっていることを確認

5. **課題報告を確認**
   - 課題が発生したタスクの通知を確認
   - 通知をクリックしてタスク詳細に遷移できることを確認

6. **プロジェクト詳細で統合表示を確認**
   - プロジェクト詳細ページの「報告」タブまたはセクションを確認
   - 全タスクエージェントからの報告が集約表示されることを確認

#### ✅ 確認ポイント

- [ ] 通知ベルに未読件数バッジが表示される
- [ ] 通知ドロップダウンが開く
- [ ] タスクエージェントからの報告が表示される
- [ ] 遅延タスクの警告が表示される
- [ ] 課題報告が表示される
- [ ] 通知クリックでタスク詳細に遷移できる
- [ ] プロジェクト詳細で報告が集約表示される

#### 📸 スクリーンショット撮影ポイント

- 通知ベル（未読バッジ）
- 通知ドロップダウン
- 進捗報告通知
- 遅延警告通知
- 課題報告通知
- 報告集約表示

---

## テスト完了チェックリスト

### ユーザーパターン
- [ ] シナリオ1: 新規ユーザー登録
- [ ] シナリオ2: エージェント間自動面接
- [ ] シナリオ3: オファー確認
- [ ] シナリオ4: プロジェクト参加決定
- [ ] シナリオ5: タスク実行とエージェントサポート
- [ ] シナリオ6: タスク完了

### PMパターン
- [ ] シナリオ1: プロジェクト作成
- [ ] シナリオ2: WBS・ガントチャート自動生成
- [ ] シナリオ3: 面接結果確認
- [ ] シナリオ4: タスク自動割り当て
- [ ] シナリオ5: プロジェクトエージェントとの会話
- [ ] シナリオ6: タスク状況確認とPMへの通知

### 統合テスト
- [ ] データフローの整合性確認
- [ ] UI/UXの使いやすさ確認
- [ ] パフォーマンス確認（各操作が2秒以内）
- [ ] エラーハンドリング確認

---

## トラブルシューティング

### データベース接続エラー
```
Error: Can't reach database server at localhost:5433
```

**解決方法**:
```bash
# データベースが起動しているか確認
docker ps

# 起動していない場合
docker compose up -d

# 開発サーバーを再起動
# Ctrl+C で停止後
npm run dev
```

### ページが表示されない
- ブラウザのキャッシュをクリア（Cmd+Shift+R / Ctrl+Shift+R）
- 開発サーバーを再起動
- ブラウザのコンソールでエラーを確認

### ユーザー切り替えができない
- `/api/users` APIが正常に動作しているか確認:
  ```bash
  curl http://localhost:3000/api/users
  ```
- データベースにユーザーデータが存在するか確認:
  ```bash
  PGPASSWORD=cristal_dev_password psql -h localhost -p 5433 -U cristal -d cristal_match -c "SELECT id, name, role FROM \"User\";"
  ```

### タスク自動生成ボタンが表示されない
- プロジェクトに既にタスクが存在する可能性があります
- プロジェクト詳細ページでタスク数を確認してください
- タスクを削除するか、新しいプロジェクトを作成してください

---

## テスト結果記録テンプレート

### 実施情報
- **実施日**: YYYY-MM-DD
- **実施者**:
- **環境**: http://localhost:XXXX
- **データベース**: PostgreSQL localhost:5433

### シナリオ結果

| シナリオ | 結果 | 所要時間 | 備考 |
|---------|------|---------|------|
| ユーザー1: 登録 | ✅/❌ | XX秒 | |
| ユーザー2: 面接 | ✅/❌ | XX秒 | |
| ユーザー3: オファー | ✅/❌ | XX秒 | |
| ユーザー4: 参加決定 | ✅/❌ | XX秒 | |
| ユーザー5: タスク実行 | ✅/❌ | XX秒 | |
| ユーザー6: タスク完了 | ✅/❌ | XX秒 | |
| PM1: プロジェクト作成 | ✅/❌ | XX秒 | |
| PM2: タスク生成 | ✅/❌ | XX秒 | |
| PM3: 面接結果確認 | ✅/❌ | XX秒 | |
| PM4: タスク割り当て | ✅/❌ | XX秒 | |
| PM5: エージェント会話 | ✅/❌ | XX秒 | |
| PM6: 通知確認 | ✅/❌ | XX秒 | |

### 発見した問題
1.
2.
3.

### 総評
- **全体の印象**:
- **使いやすさ**:
- **パフォーマンス**:
- **改善提案**:

---

作成日: 2025-10-28
最終更新: 2025-10-28
